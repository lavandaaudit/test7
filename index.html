<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>IBONARIUM ¬∑ SOLAR EVENTS ¬∑ LIST</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
html,body{
    margin:0;
    background:#000;
    color:#d8f3ff;
    font-family: Inter, system-ui, monospace;
}
header{
    padding:12px;
    text-align:center;
    border-bottom:1px solid #133;
    letter-spacing:2px;
}
#events{
    padding:12px;
}
.event{
    border-bottom:1px solid #122;
    padding:8px 0;
}
.time{color:#7ff}
.type{font-weight:bold}
.X{color:#ff4b4b}
.M{color:#ffb347}
.C{color:#7fff7f}
.meta{opacity:.8;font-size:12px}
footer{
    text-align:center;
    padding:8px;
    font-size:11px;
    opacity:.5;
}
</style>
</head>

<body>

<header>
IBONARIUM :: SOLAR EVENTS :: LIST
</header>

<div id="events">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>

<footer>
NASA DONKI ¬∑ list mode ¬∑ auto update 15 min
</footer>

<script>
const API_KEY = "DEMO_KEY";

function isoDate(d){
    return d.toISOString().split("T")[0];
}

// –±–µ—Ä–µ–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ 5 –¥–Ω—ñ–≤ ‚Äî —Å—Ç–∞–±—ñ–ª—å–Ω–æ
const end = isoDate(new Date());
const start = isoDate(new Date(Date.now() - 5*24*3600*1000));

const FLR_URL =
`https://api.nasa.gov/DONKI/FLR?startDate=${start}&endDate=${end}&api_key=${API_KEY}`;

const CME_URL =
`https://api.nasa.gov/DONKI/CME?startDate=${start}&endDate=${end}&api_key=${API_KEY}`;

async function load(){
    const box = document.getElementById("events");
    box.innerHTML = "";

    try{
        const flr = await fetch(FLR_URL).then(r=>r.json());
        const cme = await fetch(CME_URL).then(r=>r.json());

        const events = [
            ...flr.map(e=>({...e,_type:"FL"})),
            ...cme.map(e=>({...e,_type:"CME"}))
        ];

        events.sort((a,b)=>{
            const ta = new Date(a.beginTime || a.startTime);
            const tb = new Date(b.beginTime || b.startTime);
            return tb - ta;
        });

        if(events.length===0){
            box.innerHTML="–ü–æ–¥—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";
            return;
        }

        events.slice(0,20).forEach(e=>{
            const div = document.createElement("div");
            div.className="event";

            const cls = e.classType || "";
            const clsType = cls.charAt(0);

            const instruments = e.instruments
              ? e.instruments.map(i=>i.displayName).join(", ")
              : "NASA";

            div.innerHTML = `
                <div class="time">‚è± ${e.beginTime || e.startTime}</div>
                <div class="type">
                    ‚òÄ ${e._type}
                    <span class="${clsType}">${cls}</span>
                </div>
                <div class="meta">
                    üìç ${e.sourceLocation || "‚Äî"}<br>
                    üõ∞ ${instruments}
                </div>
            `;
            box.appendChild(div);
        });

    }catch(err){
        box.innerText = "–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö NASA DONKI";
        console.error(err);
    }
}

load();
setInterval(load, 900000); // 15 —Ö–≤
</script>

</body>
</html>
